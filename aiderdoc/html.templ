package aiderdoc

import "node.town/http"

templ EntriesTemplate(articles []Article) {
	@http.RootTemplate("Aider Chronicle") {
		<style>
			body {
				font-family: sans-serif;
				line-height: 1.6;
				color: #333;
				max-width: 800px;
				margin: 0 auto;
				padding: 20px;
			}
			.article {
				margin-bottom: 40px;
			}
			.date {
				font-size: 1.2em;
				font-weight: bold;
				margin-bottom: 20px;
				color: #666;
			}
			.section {
				margin-bottom: 30px;
			}
			.section-timestamp {
				font-family: 'DM Mono', monospace;
				font-size: 0.8em;
				color: #888;
				margin-bottom: 10px;
			}
			.section-content {
				background-color: #f9f9f9;
				border-radius: 5px;
				padding: 15px;
			}
			.entry {
				display: inline;
				margin-right: 5px;
			}
			.entry-type {
				font-family: 'DM Mono', monospace;
				font-weight: 600;
				font-size: 0.9em;
				margin-right: 5px;
			}
			.entry-content {
				white-space: pre-wrap;
			}
			.code .entry-content {
				font-family: 'DM Mono', monospace;
			}
			.voice .entry-content {
				font-style: italic;
			}
			tt {
				background-color: #e6e6e6;
				padding: 2px 4px;
				border-radius: 3px;
			}
		</style>
		for _, article := range articles {
			@articleTemplate(article)
		}
	}
}

templ articleTemplate(article Article) {
	<div class="article">
		if article.NewDay {
			<div class="date">{ article.StartTime.Format("Monday, 2 January") }</div>
		}
		for _, section := range article.Sections {
			@sectionTemplate(section)
		}
	</div>
}

templ sectionTemplate(section Section) {
	<div class="section">
		<div class="section-timestamp">{ section.StartTime.Format("15:04") }</div>
		<div class="section-content">
			for _, entry := range section.Entries {
				@entryTemplate(entry)
			}
		</div>
	</div>
}

templ entryTemplate(entry Entry) {
	<span class={ "entry", templ.KV("ask", entry.InputMode == InputModeAsk), templ.KV("code", entry.InputMode == InputModeCode), templ.KV("voice", entry.IsVoice) }>
		<span class="entry-type">
			switch entry.Type {
				case EntryTypeAsk:
					{ "‚ùì" }
				case EntryTypeRun:
					{ "‚ñ∂Ô∏è" }
				case EntryTypeUndo:
					{ "‚Ü©Ô∏è" }
				case EntryTypeClear:
					{ "üßπ" }
				case EntryTypeAdd:
					{ "‚ûï" }
				case EntryTypeDrop:
					{ "‚ûñ" }
				default:
					if entry.InputMode == InputModeAsk {
						if entry.IsVoice {
							{ "üéôÔ∏è" }
						} else {
							{ "üí¨" }
						}
					} else {
						if entry.IsVoice {
							{ "üéôÔ∏è" }
						} else {
							{ "‚å®Ô∏è" }
						}
					}
			}
		</span>
		<span class="entry-content">
			for _, span := range entry.Content {
				if span.IsCode {
					<tt>{ span.Text }</tt>
				} else {
					{ span.Text }
				}
			}
		</span>
	</span>
}
